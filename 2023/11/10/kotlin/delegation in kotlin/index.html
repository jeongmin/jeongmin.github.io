<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>코틀린에서의 위임 | 코딩 소년의 블로그</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="이번 포스트에서는 위임에 대해 구체적인 개념부터 사용법을 알아보려 합니다. 이를 위해 안드로이드의 젯팩 컴포즈에서 사용되는 실제 코드(mutableStateOf)를 분석함으로써 위임에 대한 이해도를 높이고 동시에 이를 어떻게 커스텀하고 이용할 수 있을지도 함께 살펴 보도록 하겠습니다. 위임(Delegation)의 개념위임은 다른 사람에게 나의 일을 맡기는">
<meta property="og:type" content="article">
<meta property="og:title" content="코틀린에서의 위임">
<meta property="og:url" content="https://jeongmin.github.io/2023/11/10/kotlin/delegation%20in%20kotlin/index.html">
<meta property="og:site_name" content="코딩 소년의 블로그">
<meta property="og:description" content="이번 포스트에서는 위임에 대해 구체적인 개념부터 사용법을 알아보려 합니다. 이를 위해 안드로이드의 젯팩 컴포즈에서 사용되는 실제 코드(mutableStateOf)를 분석함으로써 위임에 대한 이해도를 높이고 동시에 이를 어떻게 커스텀하고 이용할 수 있을지도 함께 살펴 보도록 하겠습니다. 위임(Delegation)의 개념위임은 다른 사람에게 나의 일을 맡기는">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2023-11-09T15:00:00.000Z">
<meta property="article:modified_time" content="2023-11-10T01:34:39.661Z">
<meta property="article:author" content="이정민">
<meta property="article:tag" content="android">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="kotlin">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="코딩 소년의 블로그" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">코딩 소년의 블로그</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">가고가고 가다보면 알게된다. 하고하고 하다보면 깨닫게 된다.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="검색"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jeongmin.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-kotlin/delegation in kotlin" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/10/kotlin/delegation%20in%20kotlin/" class="article-date">
  <time class="dt-published" datetime="2023-11-09T15:00:00.000Z" itemprop="datePublished">2023-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">programming</a>►<a class="article-category-link" href="/categories/programming/kotlin/">kotlin</a>►<a class="article-category-link" href="/categories/programming/kotlin/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      코틀린에서의 위임
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>이번 포스트에서는 위임에 대해 구체적인 개념부터 사용법을 알아보려 합니다. 이를 위해 안드로이드의 젯팩 컴포즈에서 사용되는 실제 코드(<code>mutableStateOf</code>)를 분석함으로써 위임에 대한 이해도를 높이고 동시에 이를 어떻게 커스텀하고 이용할 수 있을지도 함께 살펴 보도록 하겠습니다.</p>
<h1 id="위임-Delegation-의-개념"><a href="#위임-Delegation-의-개념" class="headerlink" title="위임(Delegation)의 개념"></a>위임(Delegation)의 개념</h1><p>위임은 다른 사람에게 나의 일을 맡기는 행위라고 할 수 있습니다.</p>
<p>제가 까페를 운영한다고 합시다. 까페를 운영하는 일은 매장관리, 재고관리, 홍보, 음료 준비 등 다양한 일을 포함합니다. 이를 혼자 다하는건 아주 힘든 일입니다. 그래서 저는 숙련된 바리스타인 “동동이”를 고용했습니다. 동동이는 손님이 오면 음료 준비와 관련된 모든 업무를 수행합니다. 즉 저는 동동이에게 음료 준비를 <strong>위임</strong> 함으로써 까페 운영을 위한 다른 업무에 집중하고, 좀 더 효율적으로 까페를 운영할 수 있게 되었습니다.</p>
<h2 id="구성요소"><a href="#구성요소" class="headerlink" title="구성요소"></a>구성요소</h2><p>위의 예제에서 까페 사장인 저는 델리게이터(Delegator), 바리스타로 고용된 동동이는 델리게이트(Delegate)라고 합니다. 델리게이터는 일을 떠넘기는 사람이고, 델리게이트는 일을 대신 받아서 해주는 사람입니다.</p>
<h2 id="프로그래밍에서의-위임"><a href="#프로그래밍에서의-위임" class="headerlink" title="프로그래밍에서의 위임"></a>프로그래밍에서의 위임</h2><p>직관적으로 위임을 잘 사용하면 내가 하려고 하는 일을 좀 더 효율적으로 할 수 있다는 것은 명확합니다. 그럼 프로그래밍의 세계에서는 위임이 구체적으로 어떤 방식으로 우리 일을 효율적으로 할 수 있도록 도와 줄까요?</p>
<h3 id="위임의-장점"><a href="#위임의-장점" class="headerlink" title="위임의 장점"></a>위임의 장점</h3><p>위임의 장점을 코드의 관점에서 바라보면 크게 아래 세 가지로 나눌 수 있습니다.</p>
<ul>
<li>코드의 재사용성<br>  동동이는 바리스타로서 음료 준비의 전문가입니다. 손님으로 부터 주문을 받으면 계속 동동이를 이용해서 음료를 제공할 수 있습니다. 제가 새로운 까페 체인점을 만든다면 다른 체인점에서 동동이를 쓸 수도 있겠죠. 잠시 일을 도우러 온 알바 생이 궁금한게 있으면 동동이에게 도움을 받을 수도 있습니다. 이렇게 바리스타로서 음료의 전문가인 동동이로부터 음료와 완련된 모든 일들에 걸쳐 도움 받을 수 있으니 재사용성이 높습니다.</li>
<li>관심사의 분리(SoC - Separation of Concerns)<br>  까페의 사장으로서 저는 까페의 운영이라는 작업에 집중하고 음료 준비와 관련된 일들은 전문가인 동동이에게 맡길 수 있습니다. 즉 까페 운영이라는 관심사와 음료 준비라는 관심사가 분리되었습니다. </li>
<li>확장성 &amp; 동적 행위 변경<br>  음료의 퀄리티나 스타일을 바꾸고 싶으면 동동이를 변경하거나, 동동이를 해고하고 다른 바리스타를 고용하기만 하면 됩니다. 까페의 다른 구성요소의 변경 없이 최소한의 수정으로 런타임에 행위를 변경할 수 있습니다.</li>
</ul>
<h1 id="기본-사용법-클래스-위임"><a href="#기본-사용법-클래스-위임" class="headerlink" title="기본 사용법 - 클래스 위임"></a>기본 사용법 - 클래스 위임</h1><p>클래스 위임을 이용하면 인터페이스의 구현을 다른 델리게이트에게 넘길 수 있습니다. 즉 인터페이스의 기능(함수)와 데이터(속성)를 직접 구현할 필요 없이 다른 객체를 이용해서 처리할 수 있습니다.</p>
<h2 id="인터페이스의-구현을-특정-델리게이트로-위임하기"><a href="#인터페이스의-구현을-특정-델리게이트로-위임하기" class="headerlink" title="인터페이스의 구현을 특정 델리게이트로 위임하기"></a>인터페이스의 구현을 특정 델리게이트로 위임하기</h2><p>아래의 예제를 보면 <code>Barista</code>를 구현하는 클래스를 생성하면서 <code>by</code> 키워드를 이용하여 <code>Barista</code>의 구현을 특정 델리게이트로 넘길 수 있습니다.</p>
<p>여기서는 <code>Barista</code>를 구현하는 <code>StarbucksBarista</code> 또는 <code>EdiyaBarista</code> 둘 중 하나가 되겠네요.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Interface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Barista</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StarbucksBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Starbucks-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EdiyaBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Ediya-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegator: Cafe, Delegate: StarbucksBarista</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StarbucksCafe</span>(): Barista <span class="keyword">by</span> StarbucksBarista</span><br><span class="line"><span class="comment">// Delegator: Cafe, Delegate: EdiyaBarista</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EdiyaCafe</span>(): Barista <span class="keyword">by</span> EdiyaBarista</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> starbucks = StarbucksCafe()</span><br><span class="line">    starbucks.makeCoffee()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> ediya = EdiyaCafe()</span><br><span class="line">    ediya.makeCoffee()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="인터페이스의-구현을-생성자를-이용하여-특정-델리게이트로-위임-하기"><a href="#인터페이스의-구현을-생성자를-이용하여-특정-델리게이트로-위임-하기" class="headerlink" title="인터페이스의 구현을 생성자를 이용하여 특정 델리게이트로 위임 하기"></a>인터페이스의 구현을 생성자를 이용하여 특정 델리게이트로 위임 하기</h2><p>좀 더 유연하게 쓰고 싶다면 아래 처럼 쓸 수 있습니다. 생성자를 통해 <code>Barista</code> 인터페이스를 구현하는 구현체를 넘기는 방식입니다. <code>Cafe</code> 클래스에 <code>Barista</code>만 바꿔서 생성하면 되니 좀 더 유연하다고 할 수 있겠네요. 이 방법은 처음 방식보다 조금 더 유연하지만 여전히 객체의 생성 시 바리스타가 고정되며, 이후 바리스타를 바꾸는 것은 불가능합니다.  까페를 개업할 때 바리스타를 고용해서 평생 함께 가는거네요. 바리스타 입장에선 고용 안정이 되어서 좋지만 사장 입장에선 자유롭게 바리스타를 바꿀 수 있었으면 좋겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Interface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Barista</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StarbucksBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Starbucks-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EdiyaBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Ediya-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegator: Cafe, Delegate: barista</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cafe</span>(barista: Barista): Barista <span class="keyword">by</span> barista</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage of Cafe</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> main &#123;</span></span><br><span class="line">    <span class="keyword">val</span> starbucks = Cafe(StarbucksBarista())</span><br><span class="line">    starbucks.makeCoffee()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> ediya = Cafe(EdiyaBarista())</span><br><span class="line">    ediya.makeCoffee()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="동적으로-델리게이트-변경하기"><a href="#동적으로-델리게이트-변경하기" class="headerlink" title="동적으로 델리게이트 변경하기"></a>동적으로 델리게이트 변경하기</h2><p>동적으로 런타임에 새로운 객체 생성 없이 바리스타를 바꾸고 싶다면 이렇게 하면 됩니다. 델리게이터인 <code>Cafe</code> 객체를 생성할 때 델리게이트를 넣어줄 수도 있지만 <code>changeBarista</code>를 이용하여 객체의 재 생성 없이 델리게이트를 변경 할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Interface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Barista</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StarbucksBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Starbucks-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Delegate</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EdiyaBarista</span> : <span class="type">Barista</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Make Ediya-style coffee&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delegator: Cafe, Delegate: changable in runtime</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cafe</span>(b: Barista): Barista <span class="keyword">by</span> b &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">var</span> barista: Barista = b</span><br><span class="line"></span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">makeCoffee</span><span class="params">()</span></span> &#123;</span><br><span class="line">		barista.makeCoffee()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">changeBarista</span><span class="params">(newBarista: <span class="type">Barista</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">this</span>.barista = newBarista</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage of Cafe</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> main &#123;</span></span><br><span class="line">    <span class="keyword">val</span> cafe = Cafe(StarbucksBarista())</span><br><span class="line">    cafe.makeCoffee()</span><br><span class="line"></span><br><span class="line">    cafe.changeBarista(EdiyaBarista())</span><br><span class="line">    cafe.makeCoffee()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="기본-사용법-2-프로퍼티-위임"><a href="#기본-사용법-2-프로퍼티-위임" class="headerlink" title="기본 사용법 - 2. 프로퍼티 위임"></a>기본 사용법 - 2. 프로퍼티 위임</h1><p>말 그대로 속성의 접근을 다른 객체에 위임하는 방법입니다.  즉 속성의 값을 <strong>읽거나 쓰는 두 가지 동작</strong>을 다른 객체에 위임 할 수 있다는 말이 됩니다.</p>
<p>코틀린에서는 몇 가지 프로퍼티 위임을 처리하는 델리게이트를 제공합니다.</p>
<h3 id="코틀린에서-제공하는-내장-Delegate의-종류"><a href="#코틀린에서-제공하는-내장-Delegate의-종류" class="headerlink" title="코틀린에서 제공하는 내장 Delegate의 종류"></a>코틀린에서 제공하는 내장 Delegate의 종류</h3><h4 id="Lazy-Properties"><a href="#Lazy-Properties" class="headerlink" title="Lazy Properties"></a>Lazy Properties</h4><p>속성의 <strong>지연 초기화</strong>를 지원합니다. 아래의 예에서 <code>lazyValue</code>는 최초 접근 시 <code>lazy</code> 함수에 전달되는 객체의 초기화 로직을 수행하는 람다 함수를 호출함으로써 객체를 초기화 합니다. 이 로직은 최초 접근 시 한번만 호출되며 이후에는 초기화 된 값으로 데이터 읽기가 수행됩니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy &#123;</span><br><span class="line">    println(<span class="string">&quot;Computed!&quot;</span>)</span><br><span class="line">    <span class="string">&quot;Hello&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h4><p><code>Delegates.observable</code>는 첫번째 파라미터로 초기값을, 두번째 파라미터로는 람다 함수를 인자로 받습니다. 람다 함수는 <code>old</code>, <code>new</code>로 이전 값과, 새로 바뀐 값을 전달해줍니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name: String <span class="keyword">by</span> Delegates.observable(<span class="string">&quot;&lt;no name&gt;&quot;</span>) &#123; prop, old, new -&gt;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$old</span> -&gt; <span class="variable">$new</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">name = <span class="string">&quot;first&quot;</span></span><br><span class="line">name = <span class="string">&quot;second&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// result</span></span><br><span class="line">&lt;no name&gt; -&gt; first</span><br><span class="line">first -&gt; second</span><br></pre></td></tr></table></figure>
<h4 id="Vetoable"><a href="#Vetoable" class="headerlink" title="Vetoable"></a>Vetoable</h4><p><code>Delegates.vetoable</code>은 <code>Delegates.observable</code>과 다르게 값이 변경되기 전에 콜백이 호출됩니다.  두번째 파라미터에서 <code>Delegates.observable</code>과 다른 점은 <code>Boolean</code>을 반환하는 람다를 파라미터로 받는 다는 점인데 이 값이 <code>true</code>인 경우에만 값이 변경됩니다.  </p>
<p>아래의 예제에서는 새 값이 기존 값보다 클때만 max의 값이 변경됩니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> max: <span class="built_in">Int</span> <span class="keyword">by</span> Delegates.vetoable(<span class="number">0</span>) &#123; prop, old, new -&gt;</span><br><span class="line">    new &gt; old</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(max) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">max = <span class="number">10</span></span><br><span class="line">println(max) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">max = <span class="number">5</span></span><br><span class="line">println(max) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<p>아래와 같이 사용하면 아예 예외를 던지도록 하는 것도 가능합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> max: <span class="built_in">Int</span> <span class="keyword">by</span> Delegates.vetoable(<span class="number">0</span>) &#123; property, oldValue, newValue -&gt;</span><br><span class="line">    <span class="keyword">if</span> (newValue &gt; oldValue) <span class="literal">true</span> <span class="keyword">else</span> <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;New value must be larger than old value.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(max) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">max = <span class="number">10</span></span><br><span class="line">println(max) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// max = 5 // will fail with IllegalArgumentException</span></span><br></pre></td></tr></table></figure>
<h4 id="Map-Delegation"><a href="#Map-Delegation" class="headerlink" title="Map Delegation"></a>Map Delegation</h4><p>위임을 이용하면 <code>map</code>에 있는 값을 속성으로 사용할 수 있습니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> properties = mapOf(</span><br><span class="line">    <span class="string">&quot;name&quot;</span> to <span class="string">&quot;jude&quot;</span></span><br><span class="line">    <span class="string">&quot;age&quot;</span> to <span class="number">10</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> map: Map&lt;String, Any?&gt;) &#123; </span><br><span class="line">	<span class="keyword">val</span> name: String <span class="keyword">by</span> map </span><br><span class="line">	<span class="keyword">val</span> age: <span class="built_in">Int</span> <span class="keyword">by</span> map </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> user = User(properties)</span><br><span class="line">println(user) <span class="comment">// User(map=&#123;name=jude, age=10&#125;)</span></span><br><span class="line">println(user.name) <span class="comment">// jude</span></span><br><span class="line">println(user.age)  <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<p>아래와 같이 <code>mutableMap</code>을 이용하면 속성의 값을 수정 가능하도록 만들 수도 있습니다.  이를 이용하면 <code>JSON</code>을 파싱하는 작업을 아주 편하게 할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MutableUser</span>(<span class="keyword">val</span> map: MutableMap&lt;String, Any?&gt;) &#123;</span><br><span class="line">    <span class="keyword">var</span> name: String <span class="keyword">by</span> map</span><br><span class="line">    <span class="keyword">var</span> age: <span class="built_in">Int</span>     <span class="keyword">by</span> map</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="NotNull"><a href="#NotNull" class="headerlink" title="NotNull"></a>NotNull</h4><p><code>var</code>로 선언된 속성에 값이 설정되기 전에 접근하면 <code>IllegalStateException</code>을 발생 시킵니다. 이를 이용하면 런타임에 예외를 적절히 다뤄줘야하긴 하지만 선언과 값의 설정을 분리 할 수 있습니다. 참고로 코틀린에서는 <code>notNull</code>을 쓰지 않고 <code>var</code>로 변수를 선언하면서 값을 초기화 해주지 않으면 컴파일이 되지 않습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#### NotNull</span><br><span class="line">속성에 값이 설정되기 전 접근 시 IllegalStateException을 발생 시킴</span><br><span class="line">```kotlin</span><br><span class="line"><span class="keyword">var</span> notNullVar: String <span class="keyword">by</span> Delegates.notNull()</span><br></pre></td></tr></table></figure>

<h1 id="프로퍼티-위임의-커스텀"><a href="#프로퍼티-위임의-커스텀" class="headerlink" title="프로퍼티 위임의 커스텀"></a>프로퍼티 위임의 커스텀</h1><p>코틀린에서는 속성에 대한 위임을 지원합니다. 즉 클래스, 함수, 코드 블럭 안에서 사용하는 변수에 대한 접근을 델리게이트에 위임할 수 있습니다.</p>
<p>속성에 대한 접근이라고 하면 데이터를 가져오는 동작과, 데이터를 쓰는 동작이 있습니다. 따라서 속성에 대한 델리게이트는 결국 이 두 가지 동작을 커스텀 델리게이트에 구현하는 것 입니다. </p>
<p>먼저 사용법을 바로 보도록 하겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p: String <span class="keyword">by</span> Delegate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위의 샘플 코드는 아래와 같이 문법적으로 나눠서 볼 수 있습니다. 일반적인 변수 선언 방법에서 뒤에 <code>by &lt;expression&gt;</code> 이 추가된 형태로, by 뒤에 있는 델리게이트에 속성에 대한 읽기, 쓰기를 위임한다는 의미입니다.</p>
<p><code>val/var &lt;property name&gt;: &lt;Type&gt; by &lt;expression&gt;</code> </p>
<p>코틀린에서의 속성에 대한 델리게이트는 아래와 같은 형태로 구현할 수 있습니다. 아까 언급한 것처럼 읽기와 쓰기를 대신 처리해주기 위해 <code>getValue</code>와 <code>setValue</code>를 구현하고 있는걸 볼 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlin.reflect.KProperty</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Delegate</span> &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;<span class="variable">$thisRef</span>, thank you for delegating &#x27;<span class="subst">$&#123;property.name&#125;</span>&#x27; to me!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;<span class="variable">$value</span> has been assigned to &#x27;<span class="subst">$&#123;property.name&#125;</span>&#x27; in <span class="variable">$thisRef</span>.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>만약 델리게이트가 읽기 전용으로 <code>val</code>로만 쓰인다면 <code>getValue</code>만 추가하면 됩니다. 수정이 가능한 <code>var</code>로 사용하신다면 델리게이트에 <code>setValue</code>도 추가로 구현이 필요합니다.</p>
<h2 id="ReadOnlyProperty와-ReadWriteProperty-인터페이스"><a href="#ReadOnlyProperty와-ReadWriteProperty-인터페이스" class="headerlink" title="ReadOnlyProperty와 ReadWriteProperty 인터페이스"></a><code>ReadOnlyProperty</code>와 <code>ReadWriteProperty</code> 인터페이스</h2><p>코틀린 표준 라이브러리에서는 델리게이트를 만들기 위해 구현해야하는 <code>getValue</code>와 <code>setValue</code>를 정의하는 인터페이스를 제공합니다. 이름을 보면 알 수 있듯이 <code>ReadOnlyProperty</code>에서는 <code>getValue</code>만을 정의하고, <code>ReadWriteProperty</code>에서는 getValue와 setValue 둘 다 정의하고 있습니다.</p>
<p>이를 구현하지 않아도 앞서 설명한 <code>getValue</code>와 <code>setValue</code>를 구현해주면 델리게이트로 동작하지만 <code>ReadOnlyProperty</code>나 <code>ReadWriteProperty</code>를 이요하면 클래스 선언 없이 익명 클래스로 바로 델리게이트를 만들 수도 있습니다. 또한 구현하고 있는 인터페이스를 보면 바로 델리게이트로서 동작이 가능하다는 것을 알 수 있기 때문에 가독성도 올라갑니다. 복잡한 <code>getValue</code>와 <code>setValue</code>의 시그니처를 외울 필요없이 IDE의 도움을 받아 편하게 정의 할 수 있는 점도 장점이겠죠? </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">resourceDelegate</span><span class="params">(resource: <span class="type">Resource</span> = Resource()</span></span>): ReadWriteProperty&lt;Any?, Resource&gt; =</span><br><span class="line">    <span class="keyword">object</span> : ReadWriteProperty&lt;Any?, Resource&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> curValue = resource</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: Resource = curValue</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Resource</span>)</span></span> &#123;</span><br><span class="line">            curValue = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> readOnlyResource: Resource <span class="keyword">by</span> resourceDelegate()  <span class="comment">// ReadWriteProperty as val</span></span><br><span class="line"><span class="keyword">var</span> readWriteResource: Resource <span class="keyword">by</span> resourceDelegate()</span><br></pre></td></tr></table></figure>

<h1 id="실제-코드로-보는-위임의-사용-예-mutableStateOf"><a href="#실제-코드로-보는-위임의-사용-예-mutableStateOf" class="headerlink" title="실제 코드로 보는 위임의 사용 예(mutableStateOf)"></a>실제 코드로 보는 위임의 사용 예(mutableStateOf)</h1><p>안드로이드에서 <code>Jetpack Compose</code>로 UI를 개발하고 있다면 <code>State</code>의 개념은 아주 친숙할 것입니다. </p>
<p><code>Compose</code>는 데이터를 UI로 그대로 노출하는 선언형 UI 프레임워크 입니다. <code>Compose</code>에서는 UI에 노출할 데이터를 관리하는 특별한 인터페이스를 하나 제공하는데요. 바로 <code>State</code>라는 인터페이스입니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Stable</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span>&lt;<span class="type">out T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> value: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>State</code>안에는 <code>val value: T</code> 형태로 <code>value</code> 속성을 가지고 있습니다. <code>State</code>의 특별함은 <code>Composable function</code>에서 <code>State</code>의 상태 변화를 구독해서 <code>State</code>가 변경되면 자동으로 <code>재구성(Recomposition)</code> 트리거 된다는 점입니다.</p>
<p>이런 <code>State</code>는 어떤 식으로 사용될까요? 아래는 안드로이드에서 컴포즈로 UI를 개발하고 있다면 아주 친숙한 코드일거라 생각합니다.<br>(<code>Composable</code> 함수가 아닌 <code>ViewModel</code>에서는 <code>mutableStateOf</code>가 아닌 <code>mutableStateFlow</code>의 사용이 권장 되지만 이해를 돕기위한 예제로 이렇게 구성했으니 참고해주세요)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span>: <span class="type">ViewModel</span>() &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">var</span> showDialog: MutableState&lt;<span class="built_in">Boolean</span>&gt; = mutableStateOf(<span class="literal">false</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyScreen</span><span class="params">(viewModel: <span class="type">MyViewModel</span>)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (showDialog.value) &#123;</span><br><span class="line">        MyDialog(onDismissRequest = &#123;</span><br><span class="line">            showDialog.value = <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>showDialog</code>의 <code>value</code>에 따라 <code>MyDialog()</code>를 UI에 노출 합니다. <code>showDialog</code>의 값은 <code>MutableState</code>기 때문에 변경이 가능하구요. 하지만 위의 예를 보고 뭔가 이상함을 느끼신 분들도 계실거 같습니다. 사실 우리가 실제로 <code>MutableState</code>를 쓰는 방식은 대부분 아래와 같습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span>: <span class="type">ViewModel</span>() &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">var</span> showDialog: MutableState&lt;<span class="built_in">Boolean</span>&gt; <span class="keyword">by</span> mutableStateOf(<span class="literal">false</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyScreen</span><span class="params">(viewModel: <span class="type">MyViewModel</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (showDialog) &#123;</span><br><span class="line">        MyDialog(onDismissRequest = &#123;</span><br><span class="line">            showDialog = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>귀찮거나, 지저분한 코드를 병적으로 싫어하는 개발자 답게 <strong>코틀린의 위임</strong>을 이용해서 조건문에서 <code>showDialog.value</code>로 <code>State</code>에 접근하던걸 <code>showDialog</code>로 단순화 했네요. 위임을 사용했기 때문에 <code>showDialog</code>를 선언할 때 <code>=</code>가 <code>by</code>로 바뀐 것을 볼 수 있습니다.</p>
<p>그럼 <code>MutableState</code> 부터 차근차근 코드를 따라가 보도록 하겠습니다. 당연히 <code>MutableState</code> 역시 <code>State</code>를 구현하고 있는걸 볼 수 있습니다. 한 가지 눈에 띄는 부분은 <code>State</code>의 <code>value</code>를 오버라이드 하면서 <code>val</code> 키워드로 선언되었던 <code>value</code>가 변경 가능한 변수임을 나타내는 <code>var</code>로 바뀐 점입니다. <code>MutableState</code>라는 이름에서 보이듯이 <code>MutableState</code>는 가지고 있는 <code>value</code>가 변경 가능해야하기 때문입니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Stable</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MutableState</span>&lt;<span class="type">T</span>&gt; : <span class="type">State</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> value: T</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component1</span><span class="params">()</span></span>: T</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component2</span><span class="params">()</span></span>: (T) -&gt; <span class="built_in">Unit</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MutableState의-델리게이트-구현"><a href="#MutableState의-델리게이트-구현" class="headerlink" title="MutableState의 델리게이트 구현"></a>MutableState의 델리게이트 구현</h2><p><code>MutableState</code>와 <code>State</code>가 어떻게 생겼는지 보았는데 이것들이 델리게이트로는 어떻게 구현이 되어있는지를 살펴보도록 하겠습니다.</p>
<p>먼저 <code>MutableState</code>는 값의 변경이 가능해야합니다. 즉 쓰기 가능해야합니다. 따라서 <code>setValue</code>를 구현해주어야겠죠? 코드를 보면 바로 해당 함수를 찾을 수 있습니다. 아주 심플하게 <code>this.value = value</code> 이렇게 구현이 되어있네요.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MutableState<span class="type">&lt;T&gt;</span>.<span class="title">setValue</span><span class="params">(thisObj: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>그럼 <code>getValue</code> 는 어떻게 구현되어 있을까요? 역시나 간단히 <code>State</code> 인터페이스의 <code>value</code>를 반환하는 단순한 코드로 구현이 되어있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> State<span class="type">&lt;T&gt;</span>.<span class="title">getValue</span><span class="params">(thisObj: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: T = value</span><br></pre></td></tr></table></figure>

<p>델리게이트를 알기 전에는 외계어 같이 보였던 코드가 지금은 너무 단순한 코드로 읽히네요. 😆</p>
<h1 id="위임의-본질"><a href="#위임의-본질" class="headerlink" title="위임의 본질"></a>위임의 본질</h1><h2 id="상속-vs-구성-위임"><a href="#상속-vs-구성-위임" class="headerlink" title="상속 vs 구성(위임)"></a>상속 vs 구성(위임)</h2><p>앞에 설명드린 많은 예제들을 보면 사실 위임이 아닌 다양한 방식으로 구현이 가능합니다. 전 프로그래밍이 결국 글쓰기와 동일하다고 생각합니다. 글쓰기에서는 전하는 핵심 메세지가 동일하더라도 이를 표현하는 문장은 수없이 다양할 수 있습니다. </p>
<p>다만 제목에 적은 세 가지의 개념을 간단히 한번 짚고 넘어간다면 도움이 될거 같습니다. 위의 세 가지 개념은 객체지향 프로그래밍의 토대가 되는 개념 들이며 대다수의 객체지향 프로그래밍 언어에서 이를 이용하여 코드를 작성할 수 있도록 지원합니다.</p>
<h3 id="상속"><a href="#상속" class="headerlink" title="상속"></a>상속</h3><p>먼저 상속은 객체의 관계를 부모-자식 관계로, 또는 is - a 관계로 많이 표현합니다. 당연히 구현하려고 하는 객체 사이의 관계를 이렇게 표현하는게 직관적이라면 상속을 사용할 수 있습니다. 상속을 사용하면 객체간의 관계를 수직적으로 표현하여 사람이 직관적으로 이해하기 좋고 부모의 속성과 기능이 자식에게 모두 전해지기 때문에 잘 모델링 하면 공유되는 기능과 속성을 부모에 두고 코드를 재활용 할 수 있는 장점이 있습니다.</p>
<h3 id="상속보단-구성-Composition-over-Inheritance"><a href="#상속보단-구성-Composition-over-Inheritance" class="headerlink" title="상속보단 구성(Composition over Inheritance)"></a>상속보단 구성(Composition over Inheritance)</h3><p>객체 지향 디자인 원칙에서 자주 언급되는 개념입니다. 앞서 상속의 장점들을 이야기 했지만 상속의 장점은 곧 단점이 되기도 합니다. 부모의 속성과 기능이 자식에게 전해지는 것은 얼핏 보면 코드의 재사용성을 높여주기도 하지만 크게 보면 캡슐화가 약해지는 단점과, 부모의 변경에 따라 자식이 영향을 받게 되는 강한 결합이 발생하며, 상속 관계가 깊어지면 자식 객체는 지나치게 비대해 져서 필요없는 기능이나 속성이 늘어나고, 어떤 기능과 속성이 있는지를 파악하는 것도 매우 힘들어집니다.</p>
<h3 id="구성"><a href="#구성" class="headerlink" title="구성"></a>구성</h3><p>이에 따라 최근에는 상속 보단 구성을 이용해서 코드를 작성하는걸 권장하고 있습니다. 구성은 has-a 관계로 많이 표현하며 해야하는 작업을 여러 객체로 나누고 합쳐서 원하는 기능을 구현하는 방식입니다. 각각의 객체가 할 일을 나눠서 가지고 있기 때문에 캡슐화가 잘 지켜지며 상속과 같은 복잡한 수직 구조를 갖지 않습니다. 물론 이에 따라 훨씬 더 많은 객체가 생겨나고 이들의 관계가 복잡해 지는 부분은 단점이 될 수도 있습니다. </p>
<h3 id="위임"><a href="#위임" class="headerlink" title="위임"></a>위임</h3><p>위임은 객체가 필요한 기능을 다른 객체로 전달하는 방식입니다. 결국 위임은 구성의 한 방법입니다. 구성이 좀 더 강력하고 편리하게 쓰일 수 있도록 도와주는 문법적인 장치라고도 볼 수 있습니다. </p>
<p>실제로 코틀린에서 <code>by</code> 키워드를 통해 위임을 사용하면 코틀린 컴파일러는 <code>by</code>가 지정하는 객체를 직접 생성해서 해당 객체의 레퍼런스를 갖고 이를 호출 하는 방식으로 위임을 처리합니다. 즉 다른 객체를 생성하고 이를 이용해서 특정 기능을 수행하는 구성과 완전 동일합니다. 다만 코틀린에서 문법적으로 매번 해당 객체의 레퍼런스를 호출하는걸 줄여주는 것일 뿐이죠.</p>
<p>아래 코드는 코틀린 공식 페이지에 있는 설명으로, 위임이 실제 어떤 식으로 구현이 되는지를 보여줍니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> prop: Type <span class="keyword">by</span> MyDelegate()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this code is generated by the compiler instead:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> prop$delegate = MyDelegate()</span><br><span class="line">    <span class="keyword">var</span> prop: Type</span><br><span class="line">        <span class="keyword">get</span>() = prop$delegate.getValue(<span class="keyword">this</span>, <span class="keyword">this</span>::prop)</span><br><span class="line">        <span class="keyword">set</span>(value: Type) = prop$delegate.setValue(<span class="keyword">this</span>, <span class="keyword">this</span>::prop, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="위임의-대표적인-사용-예"><a href="#위임의-대표적인-사용-예" class="headerlink" title="위임의 대표적인 사용 예"></a>위임의 대표적인 사용 예</h2><p>위임이 구성의 한 방법이라고 보면 아래의 일들은 당연히 위임으로 처리하기 아주 좋은 사례라고 할 수 있습니다. 위임을 하면 특정 인터페이스나, 속성의 접근을 내가 통제할 수 있습니다. 즉 프록시나, 훅과 같은 역할을 델리게이트에 구현할 수 있는 것이죠. 결국 아래의 사용 사례들은 프록시나 훅으로 처리하기 좋은 것들이기도 합니다. </p>
<ul>
<li>로직의 재사용</li>
<li>데이터 유효성 검사</li>
<li>의존성 주입</li>
<li>동적 행위 변경</li>
<li>자원 관리</li>
<li>모니터링 &amp; 로깅</li>
<li>원래의 기능에 새로운 기능 추가</li>
</ul>
<p>이번 포스트에서는 위임에 대해 알아보았습니다. 내용이 좀 많긴 하지만 위임을 활용했을 때 가질 수 있는 많은 장점을 생각하면 여기서 다룬 내용들이 독자에게 많은 도움이 될거라 생각합니다. </p>
<p>또한 위임을 통해 구현된 코틀린, 안드로이드의 많은 기능들을 직접 코드를 따라가면서 분석해본다면 코드를 이해하는데에도 많은 도움이 될 것입니다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jeongmin.github.io/2023/11/10/kotlin/delegation%20in%20kotlin/" data-id="clorxf3h10000kzucg9mq1zp1" data-title="코틀린에서의 위임" class="article-share-link"><span class="fa fa-share">공유</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kotlin/" rel="tag">kotlin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/" rel="tag">programming</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2020/05/04/android/architecture-components/viewmodel/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">이전</strong>
      <div class="article-nav-title">안드로이드(Android) 뷰모델(ViewModel)</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/kotlin/">kotlin</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/kotlin/android/">android</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">web</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tool/emacs/">emacs</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/annotation/" rel="tag">annotation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asynctask/" rel="tag">asynctask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build-speed/" rel="tag">build speed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/card/" rel="tag">card</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chat-head/" rel="tag">chat head</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chromeadb/" rel="tag">chromeadb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dark-mode/" rel="tag">dark mode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dark-theme/" rel="tag">dark theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elpa/" rel="tag">elpa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emacs/" rel="tag">emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/enum/" rel="tag">enum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/floating-widget/" rel="tag">floating widget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/font/" rel="tag">font</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/font-family/" rel="tag">font-family</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/foundation/" rel="tag">foundation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kotlin/" rel="tag">kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/melpa/" rel="tag">melpa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monoscape/" rel="tag">monoscape</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ogtag/" rel="tag">ogtag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/org-mode/" rel="tag">org mode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package/" rel="tag">package</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/" rel="tag">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/" rel="tag">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sans-serif/" rel="tag">sans-serif</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serif/" rel="tag">serif</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/style/" rel="tag">style</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system-window/" rel="tag">system window</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testing/" rel="tag">testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/theme/" rel="tag">theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/" rel="tag">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typedef/" rel="tag">typedef</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewmodel/" rel="tag">viewmodel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewpager/" rel="tag">viewpager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vysor/" rel="tag">vysor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weblink/" rel="tag">weblink</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/widget/" rel="tag">widget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/window/" rel="tag">window</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/tags/asynctask/" style="font-size: 10px;">asynctask</a> <a href="/tags/build-speed/" style="font-size: 10px;">build speed</a> <a href="/tags/card/" style="font-size: 10px;">card</a> <a href="/tags/chat-head/" style="font-size: 10px;">chat head</a> <a href="/tags/chromeadb/" style="font-size: 10px;">chromeadb</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/dark-mode/" style="font-size: 10px;">dark mode</a> <a href="/tags/dark-theme/" style="font-size: 10px;">dark theme</a> <a href="/tags/elpa/" style="font-size: 10px;">elpa</a> <a href="/tags/emacs/" style="font-size: 16.67px;">emacs</a> <a href="/tags/enum/" style="font-size: 10px;">enum</a> <a href="/tags/floating-widget/" style="font-size: 10px;">floating widget</a> <a href="/tags/font/" style="font-size: 10px;">font</a> <a href="/tags/font-family/" style="font-size: 10px;">font-family</a> <a href="/tags/foundation/" style="font-size: 13.33px;">foundation</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/kotlin/" style="font-size: 10px;">kotlin</a> <a href="/tags/melpa/" style="font-size: 10px;">melpa</a> <a href="/tags/monoscape/" style="font-size: 10px;">monoscape</a> <a href="/tags/ogtag/" style="font-size: 10px;">ogtag</a> <a href="/tags/org-mode/" style="font-size: 13.33px;">org mode</a> <a href="/tags/package/" style="font-size: 10px;">package</a> <a href="/tags/process/" style="font-size: 10px;">process</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/sans-serif/" style="font-size: 10px;">sans-serif</a> <a href="/tags/serif/" style="font-size: 10px;">serif</a> <a href="/tags/style/" style="font-size: 10px;">style</a> <a href="/tags/system-window/" style="font-size: 10px;">system window</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/theme/" style="font-size: 10px;">theme</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/tool/" style="font-size: 16.67px;">tool</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/typedef/" style="font-size: 10px;">typedef</a> <a href="/tags/viewmodel/" style="font-size: 10px;">viewmodel</a> <a href="/tags/viewpager/" style="font-size: 10px;">viewpager</a> <a href="/tags/vysor/" style="font-size: 10px;">vysor</a> <a href="/tags/weblink/" style="font-size: 10px;">weblink</a> <a href="/tags/widget/" style="font-size: 10px;">widget</a> <a href="/tags/window/" style="font-size: 10px;">window</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">11월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">5월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">4월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">3월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">6월 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">11월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">10월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">9월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">4월 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">3월 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">12월 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/10/kotlin/delegation%20in%20kotlin/">코틀린에서의 위임</a>
          </li>
        
          <li>
            <a href="/2020/05/04/android/architecture-components/viewmodel/">안드로이드(Android) 뷰모델(ViewModel)</a>
          </li>
        
          <li>
            <a href="/2020/04/30/web/css-font/">CSS 글꼴(Font) 이야기</a>
          </li>
        
          <li>
            <a href="/2020/03/08/android/styling/android-theming/">테마(Theme)를 이용해서 다양한 모습의 안드로이드 앱 만들기</a>
          </li>
        
          <li>
            <a href="/2018/06/28/android/android-process-thread/">안드로이드의 프로세스, 쓰레드 이해하기</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 이정민<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>